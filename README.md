# Проект: Aven - Real Estate Responsive

Проект представляет собой веб-приложение для сбора заявок пользователей на недвижимость. Форма заявки отправляет данные на сервер, где они валидируются и сохраняются в базе данных SQLite. Также реализована интеграция с Facebook Pixel и Google Analytics для отслеживания событий.

## Структура проекта

│── .osp/                # Конфигурация PHP
│── css/                 # Стили CSS
│── images/              # Изображения и фавикон
│── fonts/               # Шрифты
│── js/                  # JavaScript файлы
│── database.php         # Конфигурация базы данных SQLite
│── contact.php          # Обрабатывает данные формы, валидирует их и сохраняет в базу данных SQLite, создает логи
│── checkdb.php          # Проверка данных в базе
│── index.html           # Основной HTML-файл с формой
│── request_log.txt      # Лог запросов (создается автоматически при отправке данных)
│── database.sqlite      # Файл базы данных SQLite (создается автоматически при отправке данных)

## Технологии

- PHP 8.3
- jQuery
- Bootstrap
- SQLite

## Установка и запуск

### Требования:

- Установленный веб-сервер с поддержкой PHP
- PHP 8.3+

### Инструкция по установке:

1. Скопируйте проект в папку веб-сервера:
OpenServer: OSPanel/home/
Apache/Nginx: папка проекта должна находиться в корневом каталоге веб-сервера (например, htdocs или www)

2. Настройте локальный домен (если требуется):
Добавьте в файл C:\Windows\System32\drivers\etc\hosts (Windows) или /etc/hosts (Linux/macOS):
127.0.0.1 test-traffic-devils.local;

3. Откройте браузер и перейдите по адресу:
https://test-traffic-devils.local/

## API

### POST /contact.php

Описание: Обрабатывает форму и сохраняет данные в базу данных.
Логирование всех запросов ведется в файл request_log.txt (создается автоматически после отправки)

#### Параметры запроса:

Параметр        Тип         Описание

first_name      string      Имя пользователя
last_name       string      Фамилия пользователя
email           string      Email пользователя
phone           string      Телефон пользователя
select_service  string      Время звонка
select_price    string      Бюджет
comments        string      Комментарий (необязательно)

#### Пример успешного ответа (JSON):

"response":{
        "success":true,
        "message":"Спасибо за вашу заявку! Мы скоро с вами свяжемся.",
        "geo_data":{"ip":"127.0.0.1","bogon":true}
    }

## База данных

Используется SQLite через PDO

- Таблица users - хранит информацию о пользователях:

Поле	    Тип	        Описание
id	        INTEGER	    ID 
first_name	TEXT	    Имя пользователя
last_name	TEXT	    Фамилия пользователя
email	    TEXT	    Email
phone	    TEXT	    Телефон
created_at	TIMESTAMP	Дата создания

- Таблица messages - хранит отправленные заявки:

Поле	        Тип	        Описание
id	            INTEGER	    ID 
user_id	        INTEGER	    ID пользователя (Foreign Key)
select_service	TEXT	    Время звонка
select_price	TEXT	    Бюджет
comments	    TEXT	    Комментарий
created_at	    TIMESTAMP	Дата создания заявки

### Проверка данных
Можно проверить записи в базе, открыв в браузере https://test-traffic-devils.local/checkdb.php. Cкрипт выводит все данные из users и messages.

## Дополнительно

### Осуществляется интеграция с Facebook Pixel и Google Analytics через параметры ?fbp=XXX&ggl=XXX в URL.

### Логика работы формы

#### Валидация данных

Данные формы проходят несколько этапов валидации на стороне клиента (custom.js) и сервера (contact.db):
1. Проверяется, что имя и фамилия не пустые.
2. Проверяется формат email и телефона.
3. Проверяется, выбраны ли услуги и ценовой диапазон.

#### Обработка данных

Данные формы отправляются методом `POST` на сервер через ajax (custom.js). Сервер выполняет следующие шаги:
1. Проверяет корректность данных.
2. Сохраняет информацию о пользователе в таблице `users`.
3. Сохраняет данные сообщения в таблице `messages`.
4. Создает логи.

### Реализована защита от повторной отправки формы на стороне клиента

### Реализовано сжатие и кэширование статических файлов.

### Данные о местоположении пользователя получаем с помощью API ipinfo.io.
